<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://til.chekos.dev/static/img/icon.png><title>how to solve permission error from airflow official docker image | chekos' today i learned</title><meta name=title content="how to solve permission error from airflow official docker image"><meta name=description content="what i learned tl;dr: when you use the Airflow official docker image you need to make sure that the variable AIRFLOW_UID is set to match your UID (and AIRFLOW_GID=0 aka root ) or you’re going to get permission errors. i was working on deploying Airflow on a VM at work this week and I got a permission error (Errno 13) regarding the containers’ python’s logging config. When I first started working with this docker-compose."><meta name=keywords content="docker,airflow,python,"><meta property="og:title" content="how to solve permission error from airflow official docker image"><meta property="og:description" content="what i learned tl;dr: when you use the Airflow official docker image you need to make sure that the variable AIRFLOW_UID is set to match your UID (and AIRFLOW_GID=0 aka root ) or you’re going to get permission errors. i was working on deploying Airflow on a VM at work this week and I got a permission error (Errno 13) regarding the containers’ python’s logging config. When I first started working with this docker-compose."><meta property="og:type" content="article"><meta property="og:url" content="https://til.chekos.dev/2022/01/27/how-to-solve-permission-error-from-airflow-official-docker-image/"><meta property="og:image" content="http://til.chekos.dev/img/logo.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-01-27T20:00:00+00:00"><meta property="article:modified_time" content="2022-01-27T20:00:00+00:00"><meta property="og:site_name" content="chekos' today i learned"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://til.chekos.dev/img/logo.png"><meta name=twitter:title content="how to solve permission error from airflow official docker image"><meta name=twitter:description content="what i learned tl;dr: when you use the Airflow official docker image you need to make sure that the variable AIRFLOW_UID is set to match your UID (and AIRFLOW_GID=0 aka root ) or you’re going to get permission errors. i was working on deploying Airflow on a VM at work this week and I got a permission error (Errno 13) regarding the containers’ python’s logging config. When I first started working with this docker-compose."><meta name=twitter:site content="@ChekosWH"><meta itemprop=name content="how to solve permission error from airflow official docker image"><meta itemprop=description content="what i learned tl;dr: when you use the Airflow official docker image you need to make sure that the variable AIRFLOW_UID is set to match your UID (and AIRFLOW_GID=0 aka root ) or you’re going to get permission errors. i was working on deploying Airflow on a VM at work this week and I got a permission error (Errno 13) regarding the containers’ python’s logging config. When I first started working with this docker-compose."><meta itemprop=datePublished content="2022-01-27T20:00:00+00:00"><meta itemprop=dateModified content="2022-01-27T20:00:00+00:00"><meta itemprop=wordCount content="362"><meta itemprop=image content="http://til.chekos.dev/img/logo.png"><meta itemprop=keywords content="docker,airflow,python,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style><style type=text/css>h2{color:#ff1a75;size:5px}</style></head><body><header><a href=/ class=title><h2>chekos' today i learned</h2></a><nav><a href=/>til</a>
<a href=/about>about</a>
<a href=https://chekos.dev/>chekos.dev</a></nav></header><main><h1>how to solve permission error from airflow official docker image</h1><p><i><time datetime=2022-01-27 pubdate>2022-01-27</time></i></p><content><h2 id=what-i-learned>what i learned</h2><p>tl;dr: when you use the Airflow official docker image you need to make sure that the variable <code>AIRFLOW_UID</code> is set to match <strong>your</strong> UID (and <code>AIRFLOW_GID=0</code> aka <code>root</code> ) or you’re going to get permission errors.
i was working on deploying Airflow on a VM at work this week and I got a permission error (Errno 13) regarding the containers’ python’s logging config. When I first started working with this <code>docker-compose.yml</code> i used the suggested <code>echo -e "AIRFLOW_UID=$(id -u)" > .env</code> command which provided my user id (let’s say it’s <strong>506</strong> ) from my local machine and assigned it to the <code>AIRFLOW_UID</code> key. Now that i am working in the VM and have extended my <code>.env</code> file to include other information i figured i could just use a copy of the same file. Everything else works fine except airflow cannot write logs because the user in this virtual machine with user id <strong>506</strong> does not have permission to write to this <code>./logs/</code> directory.
If you google this error i found — among a sea of <em>almost</em> right answers — that most of the solutions online are variations of “change the logs folder’s permissions to 777” meaning anyone can read, write, and execute the contents of the logs. That works. However, you don’t really need <em>everyone</em> to be able to read and write — just this airflow user.
Updating the UID on the VM’s <code>.env</code> file worked perfectly without having to mess with the permissions.</p><h2 id=how-i-learned>how i learned</h2><p>i kept getting permissions errors so i changed the <code>./logs/</code> directories permissions to 777 and ran <code>docker-compose up airflow-init</code> . Now that airflow was able to write logs i could run <code>ls -l logs/</code> and see that the owner of these logs was some user with id <strong>506</strong> which i recognized from the <code>.env</code> file.
From there all i had to do was run <code>id -u</code> to find the correct user id (the id of the user i’m logged in as in this VM) and update the <code>.env</code> file to match.</p><h2 id=reference>reference</h2><p>the airflow documentation →
<a href=https://airflow.apache.org/docs/apache-airflow/stable/start/docker.html#setting-the-right-airflow-user>airflow.apache.org/docs/apache-airflow/stable/start/docker.html</a></p><p>this stackoverflow answer →
<a href=https://stackoverflow.com/questions/67698656/cant-init-db-for-airflow-docker-compose-permission-denied/67704988#67704988>stackoverflow.com/questions/67698656/cant-init-db-for-airflow-docker-compose-permission-denied/67704988</a></p><p>this <strong>fantastic</strong> explanation of user and groups permissions →
<a href=https://unix.stackexchange.com/questions/116070/granting-write-permissions-to-a-group-to-a-folder>unix.stackexchange.com/questions/116070/granting-write-permissions-to-a-group-to-a-folder</a></p></content><p><a href=https://til.chekos.dev/tags/docker/>#docker</a>
<a href=https://til.chekos.dev/tags/airflow/>#airflow</a>
<a href=https://til.chekos.dev/tags/python/>#python</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>